import{s as et,a as He,e as tt,c as nt,h as st,d as ye,w as ot,i as rt}from"../chunks/scheduler.B_HausrX.js";import{S as it,i as lt,c as Se,a as Ve,m as Ee,t as ze,b as Ae,d as Ze}from"../chunks/index.BGGFpMsM.js";import{d as N,R as Fe,g as Oe,a as Ue,s as we,r as Ce,c as ve,b as je}from"../chunks/server.browser.D4hb9_uX.js";import{j as o}from"../chunks/jsx-runtime.QxmL55Mq.js";import{_ as ie,a as he,s as We,b as P,c as ct,u as at,d as Ye,R as ht,e as ut,f as dt,g as pt,L as Le,h as ft}from"../chunks/Room.Dup0VRTS.js";var B=(e=>(e[e.Rectangle=0]="Rectangle",e[e.Ellipse=1]="Ellipse",e[e.Path=2]="Path",e))(B||{}),C=(e=>(e[e.Top=1]="Top",e[e.Bottom=2]="Bottom",e[e.Left=4]="Left",e[e.Right=8]="Right",e))(C||{}),x=(e=>(e[e.None=0]="None",e[e.Pressing=1]="Pressing",e[e.SelectionNet=2]="SelectionNet",e[e.Translating=3]="Translating",e[e.Inserting=4]="Inserting",e[e.Resizing=5]="Resizing",e[e.Pencil=6]="Pencil",e))(x||{});const xt="_container_h9r25_1",gt="_canvas_h9r25_21",mt="_renderer_svg_h9r25_34",_t="_selection_net_h9r25_39",yt="_loading_h9r25_46",ae={container:xt,canvas:gt,renderer_svg:mt,selection_net:_t,loading:yt};function J(e){return`#${e.r.toString(16).padStart(2,"0")}${e.g.toString(16).padStart(2,"0")}${e.b.toString(16).padStart(2,"0")}`}const $e=["#DC2626","#D97706","#059669","#7C3AED","#DB2777"];function Ke(e){return $e[e%$e.length]}function wt(e,t,n){const s={x:e.x,y:e.y,width:e.width,height:e.height};return(t&C.Left)===C.Left&&(s.x=Math.min(n.x,e.x+e.width),s.width=Math.abs(e.x+e.width-n.x)),(t&C.Right)===C.Right&&(s.x=Math.min(n.x,e.x),s.width=Math.abs(n.x-e.x)),(t&C.Top)===C.Top&&(s.y=Math.min(n.y,e.y+e.height),s.height=Math.abs(e.y+e.height-n.y)),(t&C.Bottom)===C.Bottom&&(s.y=Math.min(n.y,e.y),s.height=Math.abs(n.y-e.y)),s}function Ct(e,t,n,s){const r={x:Math.min(n.x,s.x),y:Math.min(n.y,s.y),width:Math.abs(n.x-s.x),height:Math.abs(n.y-s.y)},h=[];for(const a of e){const c=t.get(a);if(c==null)continue;const{x:d,y:$,height:I,width:w}=c;r.x+r.width>d&&r.x<d+w&&r.y+r.height>$&&r.y<$+I&&h.push(a)}return h}function vt(e){if(!e.length)return"";const t=e.reduce((n,[s,r],h,a)=>{const[c,d]=a[(h+1)%a.length];return n.push(s,r,(s+c)/2,(r+d)/2),n},["M",...e[0],"Q"]);return t.push("Z"),t.join(" ")}function jt(e,t){if(e.length<2)throw new Error("Can't transform points with less than 2 points");let n=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,h=Number.NEGATIVE_INFINITY;for(const a of e){const[c,d]=a;n>c&&(n=c),s>d&&(s=d),r<c&&(r=c),h<d&&(h=d)}return{type:B.Path,x:n,y:s,width:r-n,height:h-s,fill:t,points:e.map(([a,c,d])=>[a-n,c-s,d])}}function ce(e,t,n){const s=n.getBoundingClientRect();return{x:e.clientX-s.left-t.x,y:e.clientY-s.top-t.y}}const Lt="_selection_1b141_1",$t="_selection_handle_1b141_8",z={selection:Lt,selection_handle:$t};function bt(e){const t=e[0];if(!t)return null;let n=t.x,s=t.x+t.width,r=t.y,h=t.y+t.height;for(let a=1;a<e.length;a++){const{x:c,y:d,width:$,height:I}=e[a];n>c&&(n=c),s<c+$&&(s=c+$),r>d&&(r=d),h<d+I&&(h=d+I)}return{x:n,y:r,width:s-n,height:h-r}}function Xe(){const e=ie(t=>t.presence.selection);return he(t=>{const n=e.map(s=>t.layers.get(s)).filter(Boolean);return bt(n)},We)}const m=8,Pt=N.memo(({onResizeHandlePointerDown:e})=>{const t=ie(r=>r.presence.selection.length===1?r.presence.selection[0]:null),n=he(r=>{var h;return t&&((h=r.layers.get(t))==null?void 0:h.type)!==B.Path}),s=Xe();return s?o.jsxs(o.Fragment,{children:[o.jsx("rect",{className:z.selection,style:{transform:`translate(${s.x}px, ${s.y}px)`},x:0,y:0,width:s.width,height:s.height}),n&&o.jsxs(o.Fragment,{children:[o.jsx("rect",{className:z.selection_handle,x:0,y:0,style:{cursor:"nwse-resize",width:`${m}px`,height:`${m}px`,transform:`translate(${s.x-m/2}px, ${s.y-m/2}px)`},onPointerDown:r=>{r.stopPropagation(),e(C.Top+C.Left,s)}}),o.jsx("rect",{className:z.selection_handle,x:0,y:0,style:{cursor:"ns-resize",width:`${m}px`,height:`${m}px`,transform:`translate(${s.x+s.width/2-m/2}px, ${s.y-m/2}px)`},onPointerDown:r=>{r.stopPropagation(),e(C.Top,s)}}),o.jsx("rect",{className:z.selection_handle,x:0,y:0,style:{cursor:"nesw-resize",width:`${m}px`,height:`${m}px`,transform:`translate(${s.x-m/2+s.width}px, ${s.y-m/2}px)`},onPointerDown:r=>{r.stopPropagation(),e(C.Top+C.Right,s)}}),o.jsx("rect",{className:z.selection_handle,x:0,y:0,style:{cursor:"ew-resize",width:`${m}px`,height:`${m}px`,transform:`translate(${s.x-m/2+s.width}px, ${s.y+s.height/2-m/2}px)`},onPointerDown:r=>{r.stopPropagation(),e(C.Right,s)}}),o.jsx("rect",{className:z.selection_handle,x:0,y:0,style:{cursor:"nwse-resize",width:`${m}px`,height:`${m}px`,transform:`translate(${s.x-m/2+s.width}px, ${s.y-m/2+s.height}px)`},onPointerDown:r=>{r.stopPropagation(),e(C.Bottom+C.Right,s)}}),o.jsx("rect",{className:z.selection_handle,x:0,y:0,style:{cursor:"ns-resize",width:`${m}px`,height:`${m}px`,transform:`translate(${s.x+s.width/2-m/2}px, ${s.y-m/2+s.height}px)`},onPointerDown:r=>{r.stopPropagation(),e(C.Bottom,s)}}),o.jsx("rect",{className:z.selection_handle,x:0,y:0,style:{cursor:"nesw-resize",width:`${m}px`,height:`${m}px`,transform:`translate(${s.x-m/2}px, ${s.y-m/2+s.height}px)`},onPointerDown:r=>{r.stopPropagation(),e(C.Bottom+C.Left,s)}}),o.jsx("rect",{className:z.selection_handle,x:0,y:0,style:{cursor:"ew-resize",width:`${m}px`,height:`${m}px`,transform:`translate(${s.x-m/2}px, ${s.y-m/2+s.height/2}px)`},onPointerDown:r=>{r.stopPropagation(),e(C.Left,s)}})]})]}):null}),It="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let be=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=It[n[e]&63];return t};function Nt({layer:e,onPointerDown:t,id:n,selectionColor:s}){return o.jsx("ellipse",{onPointerDown:r=>t(r,n),style:{transform:`translate(${e.x}px, ${e.y}px)`},cx:e.width/2,cy:e.height/2,rx:e.width/2,ry:e.height/2,fill:e.fill?J(e.fill):"#CCC",stroke:s||"transparent",strokeWidth:"1"})}function Pe(e,t,n,s=r=>r){return e*s(.5-t*(.5-n))}function kt(e){return[-e[0],-e[1]]}function R(e,t){return[e[0]+t[0],e[1]+t[1]]}function k(e,t){return[e[0]-t[0],e[1]-t[1]]}function M(e,t){return[e[0]*t,e[1]*t]}function Mt(e,t){return[e[0]/t,e[1]/t]}function se(e){return[e[1],-e[0]]}function Ie(e,t){return e[0]*t[0]+e[1]*t[1]}function Rt(e,t){return e[0]===t[0]&&e[1]===t[1]}function Dt(e){return Math.hypot(e[0],e[1])}function Tt(e){return e[0]*e[0]+e[1]*e[1]}function Ne(e,t){return Tt(k(e,t))}function Ge(e){return Mt(e,Dt(e))}function Bt(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function oe(e,t,n){let s=Math.sin(n),r=Math.cos(n),h=e[0]-t[0],a=e[1]-t[1],c=h*r-a*s,d=h*s+a*r;return[c+t[0],d+t[1]]}function pe(e,t,n){return R(e,M(k(t,e),n))}function ke(e,t,n){return R(e,M(t,n))}var{min:Q,PI:Ht}=Math,Me=.275,re=Ht+1e-4;function St(e,t={}){let{size:n=16,smoothing:s=.5,thinning:r=.5,simulatePressure:h=!0,easing:a=i=>i,start:c={},end:d={},last:$=!1}=t,{cap:I=!0,easing:w=i=>i*(2-i)}=c,{cap:b=!0,easing:_=i=>--i*i*i+1}=d;if(e.length===0||n<=0)return[];let y=e[e.length-1].runningLength,g=c.taper===!1?0:c.taper===!0?Math.max(n,y):c.taper,A=d.taper===!1?0:d.taper===!0?Math.max(n,y):d.taper,ee=Math.pow(n*s,2),Z=[],S=[],K=e.slice(0,10).reduce((i,u)=>{let p=u.pressure;if(h){let f=Q(1,u.distance/n),v=Q(1,1-f);p=Q(1,i+(v-i)*(f*Me))}return(i+p)/2},e[0].pressure),j=Pe(n,r,e[e.length-1].pressure,a),X,G=e[0].vector,F=e[0].point,q=F,V=F,E=q,te=!1;for(let i=0;i<e.length;i++){let{pressure:u}=e[i],{point:p,vector:f,distance:v,runningLength:L}=e[i];if(i<e.length-1&&y-L<3)continue;if(r){if(h){let O=Q(1,v/n),de=Q(1,1-O);u=Q(1,K+(de-K)*(O*Me))}j=Pe(n,r,u,a)}else j=n/2;X===void 0&&(X=j);let W=L<g?w(L/g):1,Qe=y-L<A?_((y-L)/A):1;j=Math.max(.01,j*Math.min(W,Qe));let ge=(i<e.length-1?e[i+1]:e[i]).vector,ue=i<e.length-1?Ie(f,ge):1,Je=Ie(f,G)<0&&!te,me=ue!==null&&ue<0;if(Je||me){let O=M(se(G),j);for(let de=1/13,le=0;le<=1;le+=de)V=oe(k(p,O),p,re*le),Z.push(V),E=oe(R(p,O),p,re*-le),S.push(E);F=V,q=E,me&&(te=!0);continue}if(te=!1,i===e.length-1){let O=M(se(f),j);Z.push(k(p,O)),S.push(R(p,O));continue}let _e=M(se(pe(ge,f,ue)),j);V=k(p,_e),(i<=1||Ne(F,V)>ee)&&(Z.push(V),F=V),E=R(p,_e),(i<=1||Ne(q,E)>ee)&&(S.push(E),q=E),K=u,G=f}let D=e[0].point.slice(0,2),T=e.length>1?e[e.length-1].point.slice(0,2):R(e[0].point,[1,1]),ne=[],l=[];if(e.length===1){if(!(g||A)||$){let i=ke(D,Ge(se(k(D,T))),-(X||j)),u=[];for(let p=1/13,f=p;f<=1;f+=p)u.push(oe(i,D,re*2*f));return u}}else{if(!(g||A&&e.length===1))if(I)for(let u=1/13,p=u;p<=1;p+=u){let f=oe(S[0],D,re*p);ne.push(f)}else{let u=k(Z[0],S[0]),p=M(u,.5),f=M(u,.51);ne.push(k(D,p),k(D,f),R(D,f),R(D,p))}let i=se(kt(e[e.length-1].vector));if(A||g&&e.length===1)l.push(T);else if(b){let u=ke(T,i,j);for(let p=1/29,f=p;f<1;f+=p)l.push(oe(u,T,re*3*f))}else l.push(R(T,M(i,j)),R(T,M(i,j*.99)),k(T,M(i,j*.99)),k(T,M(i,j)))}return Z.concat(l,S.reverse(),ne)}function Vt(e,t={}){var n;let{streamline:s=.5,size:r=16,last:h=!1}=t;if(e.length===0)return[];let a=.15+(1-s)*.85,c=Array.isArray(e[0])?e:e.map(({x:_,y,pressure:g=.5})=>[_,y,g]);if(c.length===2){let _=c[1];c=c.slice(0,-1);for(let y=1;y<5;y++)c.push(pe(c[0],_,y/4))}c.length===1&&(c=[...c,[...R(c[0],[1,1]),...c[0].slice(2)]]);let d=[{point:[c[0][0],c[0][1]],pressure:c[0][2]>=0?c[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],$=!1,I=0,w=d[0],b=c.length-1;for(let _=1;_<c.length;_++){let y=h&&_===b?c[_].slice(0,2):pe(w.point,c[_],a);if(Rt(w.point,y))continue;let g=Bt(y,w.point);if(I+=g,_<b&&!$){if(I<r)continue;$=!0}w={point:y,pressure:c[_][2]>=0?c[_][2]:.5,vector:Ge(k(w.point,y)),distance:g,runningLength:I},d.push(w)}return d[0].vector=((n=d[1])==null?void 0:n.vector)||[0,0],d}function Et(e,t={}){return St(Vt(e,t),t)}var zt=Et;function xe({x:e,y:t,onPointerDown:n,stroke:s,fill:r,points:h,size:a}){return o.jsx("path",{onPointerDown:n,d:vt(zt(h,{size:a??10,thinning:.5,smoothing:.5,streamline:.5})),style:{transform:`translate(${e}px, ${t}px)`},x:0,y:0,fill:r,stroke:s,strokeWidth:1})}function At({layer:e,onPointerDown:t,id:n,selectionColor:s}){const{x:r,y:h,width:a,height:c,fill:d}=e;return o.jsx("rect",{onPointerDown:$=>t($,n),style:{transform:`translate(${r}px, ${h}px)`},x:0,y:0,width:a,height:c,fill:d?J(d):"#CCC",strokeWidth:1,stroke:s||"transparent"})}const Zt=N.memo(({mode:e,onLayerPointerDown:t,id:n,selectionColor:s})=>{const r=he(h=>h.layers.get(n));if(!r)return null;switch(e!==x.Translating&&x.Resizing,r.type){case B.Ellipse:return o.jsx(Nt,{id:n,layer:r,onPointerDown:t,selectionColor:s});case B.Path:return o.jsx(xe,{points:r.points,onPointerDown:h=>t(h,n),x:r.x,y:r.y,fill:r.fill?J(r.fill):"#CCC",stroke:s},n);case B.Rectangle:return o.jsx(At,{id:n,layer:r,onPointerDown:t,selectionColor:s});default:return console.warn("Unknown layer type"),null}}),Ft="_container_16ir5_1",Ot="_color_swatch_button_16ir5_11",Ut="_color_swatch_button_active_16ir5_12",Wt="_color_swatch_16ir5_11",fe={container:Ft,color_swatch_button:Ot,color_swatch_button_active:Ut,color_swatch:Wt};function Yt({onChange:e}){return o.jsxs("div",{className:fe.container,children:[o.jsx(U,{color:{r:243,g:82,b:35},onClick:e}),o.jsx(U,{color:{r:255,g:198,b:38},onClick:e}),o.jsx(U,{color:{r:68,g:202,b:99},onClick:e}),o.jsx(U,{color:{r:39,g:142,b:237},onClick:e}),o.jsx(U,{color:{r:155,g:105,b:245},onClick:e}),o.jsx(U,{color:{r:252,g:142,b:42},onClick:e}),o.jsx(U,{color:{r:82,g:82,b:82},onClick:e}),o.jsx(U,{color:{r:255,g:255,b:255},onClick:e})]})}function U({onClick:e,color:t}){return o.jsx("button",{className:fe.color_swatch_button,onClick:()=>e(t),children:o.jsx("div",{className:fe.color_swatch,style:{background:J(t)}})})}const Kt="_button_1ozsb_1",Xt="_button_active_1ozsb_25",Re={button:Kt,button_active:Xt};function H({onClick:e,children:t,isActive:n,disabled:s}){return o.jsx("button",{className:`${Re.button} ${n?Re.button_active:""}`,onClick:e,disabled:s,children:t})}const Gt="_selection_inspector_1xczv_1",qt="_selection_inspector_delete_1xczv_12",De={selection_inspector:Gt,selection_inspector_delete:qt};function qe(){const e=ie(t=>t.presence.selection);return P(({storage:t,setMyPresence:n})=>{const s=t.get("layers"),r=t.get("layerIds");for(const h of e){s.delete(h);const a=r.indexOf(h);a!==-1&&r.delete(a)}n({selection:[]},{addToHistory:!0})},[e])}function Qt({isAnimated:e,camera:t,setLastUsedColor:n}){const s=ie(w=>w.presence.selection),r=P(({storage:w})=>{const b=w.get("layerIds"),_=[],y=b.toArray();for(let g=0;g<y.length;g++)s.includes(y[g])&&_.push(g);for(let g=_.length-1;g>=0;g--)b.move(_[g],y.length-1-(_.length-1-g))},[s]),h=P(({storage:w})=>{const b=w.get("layerIds"),_=[],y=b.toArray();for(let g=0;g<y.length;g++)s.includes(y[g])&&_.push(g);for(let g=0;g<_.length;g++)b.move(_[g],g)},[s]),a=P(({storage:w},b)=>{const _=w.get("layers");n(b),s.forEach(y=>{var g;(g=_.get(y))==null||g.set("fill",b)})},[s,n]),c=qe(),d=Xe();if(!d)return null;const $=d.width/2+d.x+t.x,I=d.y+t.y;return o.jsxs("div",{className:De.selection_inspector,style:{transform:`translate(calc(${$}px - 50%), calc(${I-16}px - 100%))`},children:[o.jsx(Yt,{onChange:a}),o.jsxs("div",{children:[o.jsx(H,{onClick:r,children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9 6.5L12 2L15 6.5H12.75V9.71429L19.976 11.7789C20.7013 11.9861 20.7013 13.0139 19.976 13.2211L12.8242 15.2645C12.2855 15.4184 11.7145 15.4184 11.1758 15.2645L4.024 13.2211C3.29872 13.0139 3.29872 11.9861 4.024 11.7789L11.25 9.71429V6.5H9ZM6.7493 15.5L4.02345 16.2788C3.29817 16.486 3.29817 17.5139 4.02345 17.7211L11.1753 19.7645C11.714 19.9184 12.285 19.9184 12.8236 19.7645L19.9755 17.7211C20.7007 17.5139 20.7007 16.486 19.9755 16.2788L17.2493 15.4999L12.8233 16.7645C12.2847 16.9184 11.7137 16.9184 11.175 16.7645L6.7493 15.5Z",fill:"currentColor"})})}),o.jsx(H,{onClick:h,children:o.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.1758 4.23547L4.024 6.27885C3.29872 6.48607 3.29872 7.51391 4.024 7.72114L11.1758 9.76452C11.7145 9.91842 12.2855 9.91842 12.8242 9.76452L19.976 7.72114C20.7013 7.51391 20.7013 6.48607 19.976 6.27885L12.8242 4.23547C12.2855 4.08156 11.7145 4.08156 11.1758 4.23547ZM4.02345 10.7788L6.7493 10L11.9992 11.5L17.2493 9.99992L19.9755 10.7788C20.7007 10.986 20.7007 12.0139 19.9755 12.2211L12.8236 14.2645C12.7991 14.2715 12.7746 14.2782 12.75 14.2845V17.5H15L12 22L9 17.5H11.25V14.2848C11.225 14.2783 11.2001 14.2716 11.1753 14.2645L4.02345 12.2211C3.29817 12.0139 3.29817 10.986 4.02345 10.7788Z",fill:"currentColor"})})})]}),o.jsx("div",{className:De.selection_inspector_delete,children:o.jsx(H,{onClick:c,children:o.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[o.jsx("path",{d:"M7.5 9H16.5V18C16.5 18.8284 15.8284 19.5 15 19.5H9C8.17157 19.5 7.5 18.8284 7.5 18V9Z",fill:"currentColor"}),o.jsx("path",{d:"M6 6.75C6 6.33579 6.33579 6 6.75 6H8.37868C8.7765 6 9.15804 5.84196 9.43934 5.56066L10.0607 4.93934C10.342 4.65804 10.7235 4.5 11.1213 4.5H12.8787C13.2765 4.5 13.658 4.65804 13.9393 4.93934L14.5607 5.56066C14.842 5.84196 15.2235 6 15.6213 6H17.25C17.6642 6 18 6.33579 18 6.75V7.5H6V6.75Z",fill:"currentColor"})]})})})]})}const Jt=N.memo(Qt);function en({connectionId:e}){const t=ct(e,r=>r.presence.cursor);if(!t)return null;const{x:n,y:s}=t;return o.jsx("path",{style:{transform:`translateX(${n}px) translateY(${s}px)`},d:"M5.65376 12.3673H5.46026L5.31717 12.4976L0.500002 16.8829L0.500002 1.19841L11.7841 12.3673H5.65376Z",fill:Ke(e)})}const tn=N.memo(en);function nn(){const e=at();return o.jsx(o.Fragment,{children:e.map(t=>o.jsx(tn,{connectionId:t},t))})}function sn(){const e=Ye(t=>({pencilDraft:t.presence.pencilDraft,penColor:t.presence.penColor}),We);return o.jsx(o.Fragment,{children:e.map(([t,n])=>n.pencilDraft?o.jsx(xe,{x:0,y:0,points:n.pencilDraft,fill:n.penColor?J(n.penColor):"#CCC"},t):null)})}const on=Fe.memo(function(){return o.jsxs(o.Fragment,{children:[o.jsx(nn,{}),o.jsx(sn,{})]})});function rn({isActive:e,onClick:t}){return o.jsx(H,{isActive:e,onClick:t,children:o.jsx("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",children:o.jsx("path",{d:"M22.8538 10.1464C22.76 10.0527 22.6329 10 22.5003 10C22.3677 10 22.2406 10.0527 22.1468 10.1464L20.4998 11.7934L24.2068 15.5004L25.8538 13.8544C25.9004 13.8079 25.9373 13.7528 25.9625 13.692C25.9877 13.6313 26.0007 13.5662 26.0007 13.5004C26.0007 13.4346 25.9877 13.3695 25.9625 13.3088C25.9373 13.248 25.9004 13.1928 25.8538 13.1464L22.8538 10.1464ZM23.4998 16.2074L19.7928 12.5004L13.2928 19.0004H13.4998C13.6324 19.0004 13.7596 19.0531 13.8534 19.1468C13.9471 19.2406 13.9998 19.3678 13.9998 19.5004V20.0004H14.4998C14.6324 20.0004 14.7596 20.0531 14.8534 20.1468C14.9471 20.2406 14.9998 20.3678 14.9998 20.5004V21.0004H15.4998C15.6324 21.0004 15.7596 21.0531 15.8534 21.1468C15.9471 21.2406 15.9998 21.3678 15.9998 21.5004V22.0004H16.4998C16.6324 22.0004 16.7596 22.0531 16.8534 22.1468C16.9471 22.2406 16.9998 22.3678 16.9998 22.5004V22.7074L23.4998 16.2074ZM16.0318 23.6754C16.0108 23.6194 15.9999 23.5602 15.9998 23.5004V23.0004H15.4998C15.3672 23.0004 15.24 22.9477 15.1463 22.8539C15.0525 22.7602 14.9998 22.633 14.9998 22.5004V22.0004H14.4998C14.3672 22.0004 14.24 21.9477 14.1463 21.8539C14.0525 21.7602 13.9998 21.633 13.9998 21.5004V21.0004H13.4998C13.3672 21.0004 13.24 20.9477 13.1463 20.8539C13.0525 20.7602 12.9998 20.633 12.9998 20.5004V20.0004H12.4998C12.44 20.0003 12.3808 19.9895 12.3248 19.9684L12.1458 20.1464C12.0982 20.1944 12.0607 20.2515 12.0358 20.3144L10.0358 25.3144C9.99944 25.4053 9.99053 25.5048 10.0102 25.6007C10.0299 25.6966 10.0772 25.7845 10.1464 25.8538C10.2157 25.923 10.3036 25.9703 10.3995 25.99C10.4954 26.0097 10.5949 26.0008 10.6858 25.9644L15.6858 23.9644C15.7487 23.9395 15.8058 23.902 15.8538 23.8544L16.0318 23.6764V23.6754Z",fill:"currentColor"})})})}function ln({isActive:e,onClick:t}){return o.jsx(H,{isActive:e,onClick:t,children:o.jsx("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",children:o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M24 12H12V24H24V12ZM10 10V26H26V10H10Z",fill:"currentColor"})})})}function cn({isActive:e,onClick:t}){return o.jsx(H,{isActive:e,onClick:t,children:o.jsx("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",children:o.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 18C11 21.866 14.134 25 18 25C21.866 25 25 21.866 25 18C25 14.134 21.866 11 18 11C14.134 11 11 14.134 11 18ZM18 9C13.0294 9 9 13.0294 9 18C9 22.9706 13.0294 27 18 27C22.9706 27 27 22.9706 27 18C27 13.0294 22.9706 9 18 9Z",fill:"currentColor"})})})}function an({onClick:e,disabled:t}){return o.jsx(H,{onClick:e,disabled:t,children:o.jsx("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M15 16H21C22.654 16 24 17.346 24 19C24 20.654 22.654 22 21 22H18V24H21C23.757 24 26 21.757 26 19C26 16.243 23.757 14 21 14H15V11L10 15L15 19V16Z",fill:"#888888"})})})}function hn({onClick:e}){return o.jsx(H,{onClick:e,children:o.jsx("svg",{width:"36",height:"36",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:o.jsx("path",{d:"M17 17H17.01M17.4 14H18C18.9319 14 19.3978 14 19.7654 14.1522C20.2554 14.3552 20.6448 14.7446 20.8478 15.2346C21 15.6022 21 16.0681 21 17C21 17.9319 21 18.3978 20.8478 18.7654C20.6448 19.2554 20.2554 19.6448 19.7654 19.8478C19.3978 20 18.9319 20 18 20H6C5.06812 20 4.60218 20 4.23463 19.8478C3.74458 19.6448 3.35523 19.2554 3.15224 18.7654C3 18.3978 3 17.9319 3 17C3 16.0681 3 15.6022 3.15224 15.2346C3.35523 14.7446 3.74458 14.3552 4.23463 14.1522C4.60218 14 5.06812 14 6 14H6.6M12 15V4M12 15L9 12M12 15L15 12",stroke:"#000000","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})})})}function un({onClick:e,disabled:t}){return o.jsx(H,{onClick:e,disabled:t,children:o.jsxs("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[o.jsx("g",{clipPath:"url(#clip0_18:85)",children:o.jsx("path",{d:"M15 24H18V22H15C13.346 22 12 20.654 12 19C12 17.346 13.346 16 15 16H21V19L26 15L21 11V14H15C12.243 14 10 16.243 10 19C10 21.757 12.243 24 15 24Z",fill:"#888888"})}),o.jsx("defs",{children:o.jsx("clipPath",{id:"clip0_18:85",children:o.jsx("rect",{width:"36",height:"36",fill:"white"})})})]})})}function dn({isActive:e,onClick:t}){return o.jsx(H,{isActive:e,onClick:t,children:o.jsx("svg",{width:"36",height:"36",viewBox:"0 0 36 36",fill:"none",children:o.jsx("path",{d:"M13 26V9L25 21.1428H18.2189L13 26Z",fill:"currentColor"})})})}const pn="_tools_panel_container_1cnwn_1",fn="_tools_panel_1cnwn_1",xn="_tools_panel_section_1cnwn_18",gn="_seperator_1cnwn_25",Y={tools_panel_container:pn,tools_panel:fn,tools_panel_section:xn,seperator:gn};function mn({canvasState:e,setCanvasState:t,undo:n,redo:s,canUndo:r,canRedo:h,download:a}){return o.jsx("div",{className:Y.tools_panel_container,children:o.jsxs("div",{className:Y.tools_panel,children:[o.jsxs("div",{className:Y.tools_panel_section,children:[o.jsx(dn,{isActive:e.mode===x.None||e.mode===x.Translating||e.mode===x.SelectionNet||e.mode===x.Pressing||e.mode===x.Resizing,onClick:()=>t({mode:x.None})}),o.jsx(rn,{isActive:e.mode===x.Pencil,onClick:()=>t({mode:x.Pencil})}),o.jsx(ln,{isActive:e.mode===x.Inserting&&e.layerType===B.Rectangle,onClick:()=>t({mode:x.Inserting,layerType:B.Rectangle})}),o.jsx(cn,{isActive:e.mode===x.Inserting&&e.layerType===B.Ellipse,onClick:()=>t({mode:x.Inserting,layerType:B.Ellipse})})]}),o.jsx("div",{className:Y.seperator}),o.jsxs("div",{className:Y.tools_panel_section,children:[o.jsx(an,{onClick:n,disabled:!r}),o.jsx(un,{onClick:s,disabled:!h})]}),o.jsx("div",{className:Y.seperator}),o.jsx("div",{className:Y.tools_panel_section,children:o.jsx(hn,{onClick:a})})]})})}const _n="_no_scroll_1upce_1",Te={no_scroll:_n};function yn(){N.useEffect(()=>(document.body.classList.add(Te.no_scroll),()=>{document.body.classList.remove(Te.no_scroll)}),[])}const Be=100,wn=e=>o.jsx(ht,{...e,children:o.jsx("div",{className:ae.container,children:o.jsx(Cn,{})})});function Cn(){const e=he(l=>l.layerIds),t=ie(l=>l.presence.pencilDraft),[n,s]=N.useState({mode:x.None}),[r,h]=N.useState({x:0,y:0}),[a,c]=N.useState({r:252,g:142,b:42}),d=ut(),$=dt(),I=pt(),w=N.useRef(null);yn();const b=qe();N.useEffect(()=>{function l(i){switch(i.key){case"Backspace":{b();break}case"z":if(i.ctrlKey||i.metaKey){i.shiftKey?d.redo():d.undo();break}}}return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[b,d]);const _=P(({self:l,setMyPresence:i},u,p)=>{if(n.mode===x.Pencil||n.mode===x.Inserting)return;d.pause(),u.stopPropagation();const f=ce(u,r,w.current);l.presence.selection.includes(p)||i({selection:[p]},{addToHistory:!0}),s({mode:x.Translating,current:f})},[s,r,d,n.mode]),y=N.useCallback((l,i)=>{d.pause(),s({mode:x.Resizing,initialBounds:i,corner:l})},[d]),g=P(({storage:l,setMyPresence:i},u,p)=>{const f=l.get("layers");if(f.size>=Be)return;const v=l.get("layerIds"),L=be(),W=new Le({type:u,x:p.x,y:p.y,height:100,width:100,fill:a});v.push(L),f.set(L,W),i({selection:[L]},{addToHistory:!0}),s({mode:x.None})},[a]),A=P(({storage:l,self:i,setMyPresence:u})=>{const p=l.get("layers"),{pencilDraft:f}=i.presence;if(f==null||f.length<2||p.size>=Be){u({pencilDraft:null});return}const v=be();p.set(v,new Le(jt(f,a))),l.get("layerIds").push(v),u({pencilDraft:null}),s({mode:x.Pencil})},[a]),ee=P(({storage:l,self:i},u)=>{if(n.mode!==x.Translating)return;const p={x:u.x-n.current.x,y:u.y-n.current.y},f=l.get("layers");for(const v of i.presence.selection){const L=f.get(v);L&&L.update({x:L.get("x")+p.x,y:L.get("y")+p.y})}s({mode:x.Translating,current:u})},[n]),Z=P(({storage:l,self:i},u)=>{if(n.mode!==x.Resizing)return;const p=wt(n.initialBounds,n.corner,u),v=l.get("layers").get(i.presence.selection[0]);v&&v.update(p)},[n]),S=P(({self:l,setMyPresence:i})=>{l.presence.selection.length>0&&i({selection:[]},{addToHistory:!0})},[]),K=P(({setMyPresence:l},i,u)=>{l({pencilDraft:[[i.x,i.y,u]],penColor:a})},[a]),j=P(({self:l,setMyPresence:i},u,p)=>{const{pencilDraft:f}=l.presence;n.mode!==x.Pencil||p.buttons!==1||f==null||i({cursor:u,pencilDraft:f.length===1&&f[0][0]===u.x&&f[0][1]===u.y?f:[...f,[u.x,u.y,p.pressure]]})},[n.mode]),X=N.useCallback((l,i)=>{Math.abs(l.x-i.x)+Math.abs(l.y-i.y)>5&&s({mode:x.SelectionNet,origin:i,current:l})},[]),G=P(({storage:l,setMyPresence:i},u,p)=>{const f=l.get("layers").toImmutable();s({mode:x.SelectionNet,origin:p,current:u});const v=Ct(e,f,p,u);i({selection:v})},[e]),F=Ye(l=>l.presence.selection),q=N.useMemo(()=>{const l={};for(const i of F){const[u,p]=i;for(const f of p)l[f]=Ke(u)}return l},[F]),V=N.useCallback(l=>{h(i=>({x:i.x-l.deltaX,y:i.y-l.deltaY}))},[]),E=Fe.useCallback(l=>{const i=ce(l,r,w.current);if(n.mode!==x.Inserting){if(n.mode===x.Pencil){K(i,l.pressure);return}s({origin:i,mode:x.Pressing})}},[r,n.mode,s,K]),te=P(({setMyPresence:l},i)=>{i.preventDefault();const u=ce(i,r,w.current);n.mode===x.Pressing?X(u,n.origin):n.mode===x.SelectionNet?G(u,n.origin):n.mode===x.Translating?ee(u):n.mode===x.Resizing?Z(u):n.mode===x.Pencil&&j(u,i),l({cursor:u})},[r,n,j,Z,X,ee,G]),D=P(({setMyPresence:l})=>l({cursor:null}),[]),T=P(({},l)=>{const i=ce(l,r,w.current);n.mode===x.None||n.mode===x.Pressing?(S(),s({mode:x.None})):n.mode===x.Pencil?A():n.mode===x.Inserting?g(n.layerType,i):s({mode:x.None}),d.resume()},[r,n,d,g,A,s,S]),ne=()=>{const l=w.current;if(!l)return;const i=document.createElement("canvas"),u=i.getContext("2d"),f=new XMLSerializer().serializeToString(l);i.width=l.clientWidth,i.height=l.clientHeight;const v=new Image;v.src="data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(f))),v.onload=()=>{u.drawImage(v,0,0);const L=i.toDataURL("image/png"),W=document.createElement("a");W.download="whiteboard-screenshot.png",W.href=L,W.click()}};return o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:ae.canvas,children:[o.jsx(Jt,{isAnimated:n.mode!==x.Translating&&n.mode!==x.Resizing,camera:r,setLastUsedColor:c}),o.jsx("svg",{ref:w,className:ae.renderer_svg,onWheel:V,onPointerDown:E,onPointerMove:te,onPointerLeave:D,onPointerUp:T,children:o.jsxs("g",{style:{transform:`translate(${r.x}px, ${r.y}px)`},children:[e.map(l=>o.jsx(Zt,{id:l,mode:n.mode,onLayerPointerDown:_,selectionColor:q[l]},l)),o.jsx(Pt,{onResizeHandlePointerDown:y}),n.mode===x.SelectionNet&&n.current!=null&&o.jsx("rect",{className:ae.selection_net,x:Math.min(n.origin.x,n.current.x),y:Math.min(n.origin.y,n.current.y),width:Math.abs(n.origin.x-n.current.x),height:Math.abs(n.origin.y-n.current.y)}),o.jsx(on,{}),t!=null&&t.length>0&&o.jsx(xe,{points:t,fill:J(a),x:0,y:0})]})})]}),o.jsx("div",{children:o.jsx(mn,{canvasState:n,setCanvasState:s,undo:d.undo,redo:d.redo,canUndo:$,canRedo:I,download:ne})})]})}var vn={BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};function jn(e){let t,n;const s=[e[1]];let r={};for(let h=0;h<s.length;h+=1)r=He(r,s[h]);return t=new e[3]({props:r}),{c(){Se(t.$$.fragment)},l(h){Ve(t.$$.fragment,h)},m(h,a){Ee(t,h,a),n=!0},p(h,a){const c=a&2?Oe(s,[Ue(h[1])]):{};t.$set(c)},i(h){n||(ze(t.$$.fragment,h),n=!0)},o(h){Ae(t.$$.fragment,h),n=!1},d(h){Ze(t,h)}}}function Ln(e){let t,n,s;const r=[e[0]];let h={$$slots:{default:[jn]},$$scope:{ctx:e}};for(let a=0;a<r.length;a+=1)h=He(h,r[a]);return n=new e[2]({props:h}),{c(){t=tt("div"),Se(n.$$.fragment),this.h()},l(a){t=nt(a,"DIV",{class:!0});var c=st(t);Ve(n.$$.fragment,c),c.forEach(ye),this.h()},h(){ot(t,"class","w-screen h-screen")},m(a,c){rt(a,t,c),Ee(n,t,null),s=!0},p(a,[c]){const d=c&1?Oe(r,[Ue(a[0])]):{};c&16&&(d.$$scope={dirty:c,ctx:a}),n.$set(d)},i(a){s||(ze(n.$$.fragment,a),s=!0)},o(a){Ae(n.$$.fragment,a),s=!1},d(a){a&&ye(t),Ze(n)}}}function $n(e){const t={publicApiKey:vn.VITE_LIVEBLOCKS_PUBLIC_API_KEY},n={roomID:"test"},s=we(ft,je.createPortal,ve,Ce),r=we(wn,je.createPortal,ve,Ce);return[t,n,s,r]}class Mn extends it{constructor(t){super(),lt(this,t,$n,Ln,et,{})}}export{Mn as component};
//# sourceMappingURL=6.CP3J6KCR.js.map
